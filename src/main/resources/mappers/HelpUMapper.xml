<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.helpu.database.HelpUMapper">

	<insert id="userRegistration" parameterType="com.helpu.model.request.UserRegistration">
    	insert into user (
    		id,
    		password,
    		name,
    		phone,
    		personal_no,
    		gender,
    		user_type,
    		token
    	) 
    	values (
    		#{id},
    		#{password},
    		#{name},
    		#{phone},
    		#{personal_no},
    		#{gender},
    		#{user_type},
    		#{token}
    	)
    </insert>
    
    <select id="checkID" parameterType="String" resultType="String">
    	select
    		id
    	from
    		user
    	where
    		id = #{id}
    </select>
    
    <select id="login" parameterType="com.helpu.model.request.Login" resultType="String">
    	select
    		user_type
    	from
    		user
    	where
    		id = #{id} and password = #{password}
    </select>
    
    <select id="getIdByPhone" parameterType="String" resultType="String">
    	select
    		id
    	from
    		user
    	where
    		phone = #{phone}
    </select>
    
    <select id="checkHelpRegistration" parameterType="Map" resultType="String">
    	select
    		requester
    	from
    		help
    	where
    		requester = #{requester} and provider = #{provider}
    </select>
    
    <insert id="helpRegistration" parameterType="Map">
  	  insert into help (
    		requester,
    		provider
    	) 
    	values (
    		#{requester},
    		#{provider}
    	)
    </insert>
    
    <delete id="helpRemove" parameterType="com.helpu.model.request.ProviderRemove">
    	delete from
    		help
    	where
    		requester = #{requester} and provider = (select id from user where phone = #{phone})
    </delete>
    
    <select id="getProviders" parameterType="String" resultType="String">
    	select
    		provider
    	from
    		help
    	where
    		requester = #{requester}
    </select>
    
    <select id="getToken" parameterType="String" resultType="String">
    	select
    		token
    	from
    		user
    	where
    		id = #{id}
    </select>
    
    <select id="getUserName" parameterType="String" resultType="String">
    	select
    		name
    	from
    		user
    	where
    		id = #{id}
    </select>
    
    <select id="getProviderPhones" parameterType="String" resultType="List">
    	select
    		phone
    	from 
    		help
    	join
    		user
    	on
    		help.provider = user.id
        where
            help.requester = #{id};
    </select>
    
</mapper>
